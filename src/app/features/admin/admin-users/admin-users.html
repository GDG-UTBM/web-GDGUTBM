<div class="p-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gdg-text">
      {{ languageService.isFrench() ? 'Gestion des utilisateurs' : 'User Management' }}
    </h1>
    <button (click)="openAddModal()" class="btn-primary">
      + {{ languageService.isFrench() ? 'Ajouter' : 'Add' }}
    </button>
  </div>

  <!-- Tableau -->
  @if (isLoading()) {
    <div class="flex justify-center py-12">
      <svg class="animate-spin h-10 w-10 text-gdg-blue" ...></svg>
    </div>
  } @else {
    <div class="bg-gdg-surface rounded-r16 border border-gdg-line overflow-hidden">
      <table class="w-full">
        <thead class="bg-gdg-bg border-b border-gdg-line">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-medium text-gdg-muted">Email</th>
          <th class="px-6 py-3 text-left text-sm font-medium text-gdg-muted">{{ languageService.isFrench() ? 'Nom' : 'Name' }}</th>
          <th class="px-6 py-3 text-left text-sm font-medium text-gdg-muted">{{ languageService.isFrench() ? 'Rôle' : 'Role' }}</th>
          <th class="px-6 py-3 text-left text-sm font-medium text-gdg-muted">{{ languageService.isFrench() ? 'École/Entreprise' : 'School/Company' }}</th>
          <th class="px-6 py-3 text-left text-sm font-medium text-gdg-muted">{{ languageService.isFrench() ? 'Actions' : 'Actions' }}</th>
        </tr>
        </thead>
        <tbody class="divide-y divide-gdg-line">
          @for (user of users(); track user.id) {
            <tr>
              <td class="px-6 py-4">{{ user.email }}</td>
              <td class="px-6 py-4">{{ user.first_name }} {{ user.last_name }}</td>
              <td class="px-6 py-4">
                <select (change)="changeRole(user.id, $event)" class="border border-gdg-line rounded-r4 px-2 py-1 text-sm">
                  <option value="student" [selected]="user.role === 'student'">Étudiant</option>
                  <option value="professional" [selected]="user.role === 'professional'">Professionnel</option>
                  <option value="admin" [selected]="user.role === 'admin'">Admin</option>
                </select>
              </td>
              <td class="px-6 py-4">
                {{ user.role === 'student' ? (user.school + ' - ' + user.study_level) : user.company }}
              </td>
              <td class="px-6 py-4 space-x-2">
                <button (click)="editUser(user)" class="text-gdg-blue hover:underline">
                  {{ languageService.isFrench() ? 'Modifier' : 'Edit' }}
                </button>
                <button (click)="deleteUser(user.id)" class="text-red-600 hover:underline">
                  {{ languageService.isFrench() ? 'Supprimer' : 'Delete' }}
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Modal d'ajout/édition -->
  @if (showModal()) {
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" (click)="closeModal()">
      <div class="bg-white rounded-r16 w-full max-w-md p-6 animate-scale-in" (click)="$event.stopPropagation()">
        <h3 class="text-xl font-semibold mb-4">
          {{ editingUserId() ? (languageService.isFrench() ? 'Modifier l\'utilisateur' : 'Edit user') : (languageService.isFrench() ? 'Ajouter un utilisateur' : 'Add user') }}
        </h3>
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">{{ languageService.isFrench() ? 'Prénom' : 'First name' }}</label>
            <input type="text" formControlName="first_name" class="w-full border border-gdg-line rounded-r4 px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">{{ languageService.isFrench() ? 'Nom' : 'Last name' }}</label>
            <input type="text" formControlName="last_name" class="w-full border border-gdg-line rounded-r4 px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Email</label>
            <input type="email" formControlName="email" class="w-full border border-gdg-line rounded-r4 px-3 py-2">
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">{{ languageService.isFrench() ? 'Rôle' : 'Role' }}</label>
            <select formControlName="role" class="w-full border border-gdg-line rounded-r4 px-3 py-2">
              <option value="student">Étudiant</option>
              <option value="professional">Professionnel</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">{{ languageService.isFrench() ? 'Mot de passe (si nouveau)' : 'Password (if new)' }}</label>
            <input type="password" formControlName="password" class="w-full border border-gdg-line rounded-r4 px-3 py-2">
          </div>
          <div class="flex justify-end space-x-2 pt-4">
            <button type="button" (click)="closeModal()" class="btn-secondary">{{ languageService.isFrench() ? 'Annuler' : 'Cancel' }}</button>
            <button type="submit" class="btn-primary">{{ languageService.isFrench() ? 'Enregistrer' : 'Save' }}</button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
