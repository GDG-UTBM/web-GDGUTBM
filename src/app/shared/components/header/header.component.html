<header class="header">
  <div class="container-custom header-inner">
    <a class="brand" routerLink="/">
      <img class="brand-mark"
           src="https://www.svgrepo.com/show/353810/google-developers.svg"
           alt="GDG logo">
      <span class="brand-text">
        <strong>GDG</strong><span> </span> <span class="brand-light">  UTBM</span>
      </span>
    </a>

    <nav class="nav" aria-label="Navigation principale">
      <a routerLink="/events">{{ languageService.isFrench() ? 'Événements' : 'Events' }}</a>
      <a routerLink="/about">{{ languageService.isFrench() ? 'À propos' : 'About' }}</a>
      <a routerLink="/offres">{{ languageService.isFrench() ? 'Offres' : 'Internships' }}</a>
      @if (authService.isAdmin()) {
        <a routerLink="/admin">Admin</a>
      }
    </nav>

    <div class="header-actions">
      <app-language-switcher></app-language-switcher>

      @if (authService.isAuthenticated() && authService.isProfessional()) {
        <button (click)="openTopicModal()" class="btn-secondary header-join">
          {{ languageService.isFrench() ? 'Proposer un sujet' : 'Propose topic' }}
        </button>
      }

      @if (!authService.isAuthenticated()) {
        <button (click)="openJoinModal()" class="btn-secondary header-join">
          {{ languageService.isFrench() ? 'Nous rejoindre' : 'Join us' }}
        </button>
      } @else {
        <div class="relative">
          <button (click)="toggleProfileMenu()" class="profile-trigger">
            <div class="profile-avatar">
              <span>{{ getInitials() }}</span>
            </div>
            <span class="profile-name">{{ getFirstName() }}</span>
          </button>

          @if (profileMenuOpen()) {
            <div class="profile-menu">
              <div class="profile-head">
                <p class="profile-title">{{ getFullName() }}</p>
                <p class="profile-email">{{ getEmail() }}</p>
              </div>
              <a routerLink="/profile" (click)="toggleProfileMenu()" class="profile-link">
                {{ languageService.isFrench() ? 'Mon profil' : 'My profile' }}
              </a>
              <a routerLink="/reset-password" (click)="toggleProfileMenu()" class="profile-link">
                {{ languageService.isFrench() ? 'Mot de passe' : 'Password' }}
              </a>
              <button (click)="signOut()" class="profile-link profile-link--danger">
                {{ languageService.isFrench() ? 'Déconnexion' : 'Sign out' }}
              </button>
            </div>
          }
        </div>
      }

      <button class="burger" type="button"
              (click)="toggleMobileMenu()"
              [attr.aria-expanded]="mobileMenuOpen()"
              aria-label="Ouvrir le menu"
              aria-controls="mobileMenu">
        <span class="burger-icon" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <div id="mobileMenu" class="drawer" [class.is-open]="mobileMenuOpen()">
    <div class="drawer-backdrop" (click)="closeMobileMenu()" aria-hidden="true"></div>
    <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="Menu">
      <div class="drawer-head">
        <a class="drawer-brand" routerLink="/">
          <img class="drawer-brand-mark"
               src="https://www.svgrepo.com/show/353810/google-developers.svg"
               alt="GDG logo">
          <span class="drawer-brand-text"><strong>GDG</strong> <span class="drawer-brand-light">UTBM</span></span>
        </a>
        <button class="drawer-close" type="button" aria-label="Fermer le menu" (click)="closeMobileMenu()">
          ×
        </button>
      </div>

      <div class="drawer-sep" aria-hidden="true"></div>

      <nav class="drawer-nav" aria-label="Navigation mobile">
        <a routerLink="/events" (click)="closeMobileMenu()">{{ languageService.isFrench() ? 'Événements' : 'Events' }}</a>
        <a routerLink="/about" (click)="closeMobileMenu()">{{ languageService.isFrench() ? 'À propos' : 'About' }}</a>
        <a routerLink="/offres" (click)="closeMobileMenu()">{{ languageService.isFrench() ? 'Offres' : 'Internships' }}</a>
        @if (authService.isAdmin()) {
          <a routerLink="/admin" (click)="closeMobileMenu()">Admin</a>
        }

        @if (!authService.isAuthenticated()) {
          <button (click)="openJoinModal(); closeMobileMenu()" class="btn-secondary drawer-join">
            {{ languageService.isFrench() ? 'Nous rejoindre' : 'Join us' }}
          </button>
        }
      </nav>
    </div>
  </div>
</header>

@if (showJoinModal()) {
  <app-join-modal
    (close)="closeJoinModal()"
    (registerSuccess)="onRegisterSuccess()">
  </app-join-modal>
}

@if (showTopicModal()) {
  <app-topic-modal (close)="closeTopicModal()"></app-topic-modal>
}

@if (showCompleteProfileModal()) {
  <app-complete-profile-modal
    (close)="closeCompleteProfileModal()"
    (completed)="onProfileCompleted()">
  </app-complete-profile-modal>
}
