<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"
     (click)="closeModal()">
  <div class="bg-white rounded-r24 w-full max-w-xl p-6 md:p-8 shadow-2xl animate-scale-in"
       (click)="$event.stopPropagation()">
    <div class="flex items-start justify-between gap-4 mb-6">
      <div>
        <p class="text-xs uppercase tracking-widest text-gdg-muted">
          {{ languageService.isFrench() ? 'Candidature' : 'Application' }}
        </p>
        <h3 class="text-2xl font-semibold text-gdg-text">
          {{ languageService.isFrench() ? 'Postuler à' : 'Apply to' }} {{ offerTitle }}
        </h3>
        <p class="text-sm text-gdg-muted mt-1">{{ companyName }}</p>
      </div>
      <button (click)="closeModal()" class="text-gdg-muted hover:text-gdg-text text-xl leading-none">✕</button>
    </div>

    <div class="rounded-r16 border border-gdg-line bg-gdg-bg p-4 mb-6">
      <p class="text-sm text-gdg-muted">
        {{ languageService.isFrench()
        ? 'Remplissez ce formulaire pour candidater. Nous reviendrons vers vous rapidement.'
        : 'Fill this form to apply. We will get back to you soon.' }}
      </p>
    </div>
    @if (!isAuthenticated()) {
      <div class="rounded-r16 border border-yellow-200 bg-yellow-50 p-3 mb-6 text-sm text-yellow-800">
        {{ languageService.isFrench()
        ? 'Vous n\'êtes pas connecté. Votre candidature sera enregistrée sans compte.'
        : 'You are not signed in. Your application will be saved without an account.' }}
      </div>
    }

    <form [formGroup]="applicationForm" (ngSubmit)="submitApplication()" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gdg-text mb-1">Email *</label>
        <input type="email" formControlName="email"
               class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
      </div>
      <div>
        <label class="block text-sm font-medium text-gdg-text mb-1">
          {{ languageService.isFrench() ? 'Nom complet *' : 'Full name *' }}
        </label>
        <input type="text" formControlName="fullName"
               class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
      </div>

      <div>
        <label class="block text-sm font-medium text-gdg-text mb-2">
          {{ languageService.isFrench() ? 'Profil *' : 'Profile *' }}
        </label>
        <div class="grid grid-cols-2 gap-3">
          <label class="flex items-center gap-2 border border-gdg-line rounded-r10 px-3 py-2 cursor-pointer"
                 [class.border-gdg-blue]="selectedRole() === 'student'">
            <input type="radio" formControlName="role" value="student">
            <span>{{ languageService.isFrench() ? 'Étudiant' : 'Student' }}</span>
          </label>
          <label class="flex items-center gap-2 border border-gdg-line rounded-r10 px-3 py-2 cursor-pointer"
                 [class.border-gdg-blue]="selectedRole() === 'professional'">
            <input type="radio" formControlName="role" value="professional">
            <span>{{ languageService.isFrench() ? 'Professionnel' : 'Professional' }}</span>
          </label>
        </div>
      </div>

      @if (selectedRole() === 'student') {
        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gdg-text mb-1">
              {{ languageService.isFrench() ? 'École *' : 'School *' }}
            </label>
            <input type="text" formControlName="school"
                   class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
          </div>
          <div>
            <label class="block text-sm font-medium text-gdg-text mb-1">
              {{ languageService.isFrench() ? 'Niveau d\'étude *' : 'Study level *' }}
            </label>
            <select formControlName="studyLevel"
                    class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
              <option value="">{{ languageService.isFrench() ? 'Sélectionnez' : 'Select' }}</option>
              <option value="licence">Licence</option>
              <option value="master">Master</option>
              <option value="doctorat">Doctorat</option>
              <option value="ingenieur">Ingénieur</option>
              <option value="autre">Autre</option>
            </select>
          </div>
        </div>
      }

      @if (selectedRole() === 'professional') {
        <div>
          <label class="block text-sm font-medium text-gdg-text mb-1">
            {{ languageService.isFrench() ? 'Profession *' : 'Profession *' }}
          </label>
          <input type="text" formControlName="profession"
                 class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
        </div>
      }

      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gdg-text mb-1">
            {{ languageService.isFrench() ? 'Téléphone' : 'Phone' }}
          </label>
          <input type="text" formControlName="phone"
                 class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue">
        </div>
        <div>
          <label class="block text-sm font-medium text-gdg-text mb-1">
            {{ languageService.isFrench() ? 'Message' : 'Message' }}
          </label>
          <input type="text" formControlName="message"
                 class="w-full border border-gdg-line rounded-r10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gdg-blue"
                 placeholder="{{ languageService.isFrench() ? 'Motivation, disponibilité...' : 'Motivation, availability...' }}">
        </div>
      </div>

      @if (successMessage()) {
        <div class="p-3 rounded-r10 bg-green-50 text-green-700 text-sm border border-green-100">
          {{ successMessage() }}
        </div>
      }
      @if (errorMessage()) {
        <div class="p-3 rounded-r10 bg-red-50 text-red-700 text-sm border border-red-100">
          {{ errorMessage() }}
        </div>
      }

      <div class="flex items-center justify-end gap-3 pt-2">
        <button type="button" (click)="closeModal()" class="btn-secondary">
          {{ languageService.isFrench() ? 'Annuler' : 'Cancel' }}
        </button>
        <button type="submit" [disabled]="isLoading()"
                class="btn-primary disabled:opacity-50">
          @if (isLoading()) {
            {{ languageService.isFrench() ? 'Envoi...' : 'Sending...' }}
          } @else {
            {{ languageService.isFrench() ? 'Postuler' : 'Apply' }}
          }
        </button>
      </div>
    </form>
  </div>
</div>
